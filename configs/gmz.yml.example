# GoMailZero 配置文件示例

# 节点 ID（用于多节点部署）
node_id: mx1

# 主域名
domain: example.com

# 工作目录（所有相对路径基于此目录，留空使用当前工作目录）
# workdir: /var/lib/gmz

# TLS 配置
tls:
  enabled: true
  # 手动证书配置（如果 acme.enabled = false）
  # cert_file: certs/cert.pem  # 相对于 workdir
  # key_file: certs/key.pem    # 相对于 workdir
  min_version: "1.3"  # 最低 TLS 版本
  acme:
    enabled: true
    email: admin@example.com  # ACME 注册邮箱
    dir: certs               # 证书存储目录（相对于 workdir）
    provider: letsencrypt    # letsencrypt 或 zerossl

# 存储配置
storage:
  driver: sqlite  # sqlite 或 postgres
  dsn: data.db              # SQLite 文件路径（相对于 workdir）或 Postgres 连接字符串
  maildir_root: mail         # Maildir 根目录（相对于 workdir）
  auto_migrate: true         # 启动时自动执行数据库迁移

# SMTP 配置
smtp:
  enabled: true
  ports: [25, 465, 587]  # 监听端口
  max_size: 50MB         # 最大邮件大小
  hostname: ""           # 主机名（留空使用系统主机名）
  # 外发邮件中继配置（可选，推荐配置以提高发送成功率）
  relay:
    enabled: false       # 是否启用中继服务器
    host: ""             # 中继服务器地址（如 smtp.qq.com, smtp.gmail.com）
    port: 587            # 中继服务器端口（587 用于 STARTTLS，465 用于 TLS）
    username: ""         # 邮箱账号（如 your-email@qq.com）
    password: ""         # 邮箱密码或授权码（QQ 邮箱需要使用授权码）
    use_tls: true        # 是否使用 TLS（端口 587 通常需要，465 必须使用）

# IMAP 配置
imap:
  enabled: true
  port: 993              # IMAP over TLS 端口
  max_auth_errors: 5     # 最大认证错误次数

# 反垃圾配置
antispam:
  enabled: true
  rspamd_url: ""  # Rspamd URL（留空使用内置引擎）
  clamav_url: "unix:///var/run/clamav/clamd.ctl"  # ClamAV 连接（可选）
  greylist: true   # 启用灰名单
  rate_limit: true # 启用速率限制

# WebMail 配置
webmail:
  enabled: true
  path: /webmail  # WebMail 路径
  port: 8080      # WebMail 端口

# 管理 API 配置
admin:
  api_key: ${GMZ_API_KEY}  # API 密钥（从环境变量读取）
  jwt_secret: ${GMZ_JWT_SECRET}  # JWT 密钥（从环境变量读取，用于 WebMail 和管理 API）
  port: 8081                # 管理 API 端口

# 日志配置
log:
  level: info    # trace, debug, info, warn, error, fatal
  format: json   # json 或 text
  output: stdout # stdout、stderr 或文件路径（文件路径相对于 workdir，如 logs/gmz.log）

# 指标配置
metrics:
  enabled: true
  path: /metrics  # Prometheus 指标路径
  port: 9090      # 指标端口

